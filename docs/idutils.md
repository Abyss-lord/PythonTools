# Idutils

## 身份组成方式

[中华人民共和国国家标准](https://zh.wikipedia.org/wiki/%E4%B8%AD%E5%8D%8E%E4%BA%BA%E6%B0%91%E5%85%B1%E5%92%8C%E5%9B%BD%E5%9B%BD%E5%AE%B6%E6%A0%87%E5%87%86) [GB 11643-1999《公民身份号码》](https://zh.wikisource.org/wiki/GB_11643-1999_%E5%85%AC%E6%B0%91%E8%BA%AB%E4%BB%BD%E5%8F%B7%E7%A0%81)中规定：公民身份号码是特征组合码，由十七位数字本体码和一位校验码组成。

18 位数字组合的方式是：

|    110102     |     YYYYMMDD      |      8 8      |       8       |       X       |
| :-----------: | :---------------: | :-----------: | :-----------: | :-----------: |
| 区域码 (6 位) | 出生日期码 (8 位) | 顺序码 (2 位) | 性别码 (1 位) | 校验码 (1 位) |

- **区域码** 指的是公民常住户口所在县（市、镇、区）的[行政区划代码](https://zh.wikipedia.org/wiki/%E4%B8%AD%E5%8D%8E%E4%BA%BA%E6%B0%91%E5%85%B1%E5%92%8C%E5%9B%BD%E8%A1%8C%E6%94%BF%E5%8C%BA%E5%88%92%E4%BB%A3%E7%A0%81)，如 $110102$ 是北京市-西城区。但港澳台地区居民的身份号码只精确到省级。
- **出生日期码** 表示公民出生的公历年（4 位）、月（2 位）、日（2 位）。
- **顺序码** 表示在同一区域码所标识的区域范围内，对同年、同月、同日出生的人编定的顺序号。
- **性别码** 奇数表示男性，偶数表示女性。
- 最后一位是**校验码**，这里采用的是**ISO 7064:1983, MOD 11-2**校验码系统。校验码为一位数，但如果最后采用校验码系统计算的校验码是“10”，碍于身份证号码为 18 位的规定，则以“X”代替校验码“10”。

## 校验码计算方法

1. 将身份证号码从右至左标记为 $a_{1},a_{2},\cdots,a_{17},a_{18}$ , $a_{1}$ 即为校验码；
2. 计算权重系数；
3. 计算 $S = \sum_{i=1}^{18} W_{i} a_{i}$ ，其中 $a_{i}$ 为身份证号码从右至左第 $i$ 位的值；
4. $a_{1}=(12-(s \mod 11)) \mod 11$

|  **i**  |  18   |  17   |  16   |  15   |  14   |  13   |  12   |  11   |  10   |   9   |   8   |   7   |   6   |   5   |   4   |   3   |   2   |   1   |
| :-----: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| $W_{i}$ |   7   |   9   |  10   |   5   |   8   |   4   |   2   |   1   |   6   |   3   |   7   |   9   |  10   |   5   |   8   |   4   |   2   |   1   |

使用 Python 获取身份证校验码：

```Python
class IDCardUtil
    @classmethod
    def get_check_sum(cls, s: str) -> str:
        """
        根据身份证计算最后的校验位
        :param s: 身份证 ID
        :return: 校验字符
        """
        code17 = SequenceUtil.sub_lst(s, 0, 17)
        check_sum = 0
        for i in range(0, 17):
            check_sum += ((1 << (17 - i)) % 11) * BasicConvertor.to_int(code17[i])
        check_digit = (12 - (check_sum % 11)) % 11
        if check_digit < 10:
            return f"{check_digit}"
        else:
            return 'X'
```
